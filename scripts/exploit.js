/**
 * filename: exploit.js
 *     date: 2023-07-05
 *  version: 0.5
 *   author: .m0rph
 * 
 * @param {NS} ns 
 * @param ns.args[0] Name of the target server to exploit in order to gain root access.
 */
export async function main(ns) {

   'use strict';

   if (ns.args.length > 0) {
      const hackit  = '/scripts/hackit.js';
      const target  = ns.args[0],                           // Target server
            ports   = ns.getServerNumPortsRequired(target); // Open ports required to successfully NUKE the target.

      if (ports > 0) {
         // Do we have to open ports?
         if (ns.fileExists('BruteSSH.exe',  'home')) { ns.brutessh(target);  }
         if (ns.fileExists('FTPCrack.exe',  'home')) { ns.ftpcrack(target);  }
         if (ns.fileExists('HTTPWorm.exe',  'home')) { ns.httpworm(target);  }
         if (ns.fileExists('relaySMTP.exe', 'home')) { ns.relaysmtp(target); }
         if (ns.fileExists('SQLInject.exe', 'home')) { ns.sqlinject(target); }
      }

      // TODO: ns.nuke() doesn't return anything !!!
      if (ns.nuke(target)) {
         ns.scp(hackit, target);
         // tprintf prints formatted to the terminal, where print writes to the logs.
         //  -> %s = str, %b = bin, %i = int, %d = unsigned int, %x = hex, %t = bool,
         //     %f = float, %e = float using scientific notation,
         //     %o = oct, %j = JavaScript object or array as JSON encoded string.
         ns.tprint("SUCCESS :: hackit.js copied to the target server.");
         ns.tprint("SUCCESS :: Don't forget the backdoor. Exiting !!!");
      } /* else {
         NOTE: We have to check try...catch !!!
               ns.nuke() has no return value and we cannot check if the result was a successful nuke!
         ns.tprint("ERROR :: No root access. Exiting !!!");
      } */

   } else {
      ns.tprint("ERROR :: No target passed. Exiting !!!");
   }
}
